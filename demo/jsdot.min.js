function JSDot(b,c){var a=[];var f=[];var g=new JSDot.jsdot_Impl();this.getGraph=function(){return new JSDot.Graph(g,g.graph)};this.addView=function(h,l){if(a[h]){return}var j=new JSDot.View(g,h);JSDot.load_svg_shapes(j,"shapes.svg");a[h]=j;j.getTool("Layout.SpringEmbedder",{});var k=new JSDot.Selection(g,j);switch(l){case"drag":k.allowNodes=true;k.allowEdges=true;k.allowMultiple=true;k.allowDrag=true;g.addEventHandler(j,new JSDot.Drag(g,j,k));break;case"editor":f[h]=new JSDot.Editor(g,j,k);case"hiddeneditor":break;case"static":default:k.allowNodes=false;k.allowEdges=false;k.allowMultiple=false;k.allowDrag=false;break}};this.addEventHandler=function(h,j,k){g.addEventHandler(h?a[h]||null:null,j,k)};this.removeEventHandler=function(h,j,k){g.removeEventHandler(h?a[h]||null:null,j,k)};this.getTool=function(k,h){var j=null;switch(k){case"graph":if(g.tools.GraphTools){j=g.tools.GraphTools[h]}break;case"view":if(g.tools.ViewTools){j=g.tools.ViewTools[h]}break;case"edit":if(g.tools.EditTools){j=g.tools.EditTools[h]}break}return j};var d=g.getTool("json",{});if(d){this.importJSON=function(h){d.importGraph(h)};this.exportJSON=function(){return d.exportGraph()}}if(typeof b==="string"){this.addView(b,(c?c.mode||"":""))}if(c&&c.json&&this.importJSON){this.importJSON(c.json)}}JSDot.GraphTools={};JSDot.ViewTools={Layout:{}};JSDot.EditTools={};JSDot.helper={svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",cesvg:function(a){return document.createElementNS(JSDot.helper.svgns,a)},makeCssStencil:function(a){var b={};a=a||{};if(typeof a.shape=="string"){b.shape=JSDot.shapes[a.shape]||JSDot.shapes.circle}else{b.shape=a.shape||JSDot.shapes.circle}b.cssClass=a.cssClass||"jsdot_circle";b.cssHl="jsdot_def_hl";b.draw=a.draw||function(h,f,c){this.shape.draw(h,f,c);c.setAttribute("class",this.cssClass)};b.setPosition=a.setPosition||function(f,c){this.shape.setPosition(f,c)};b.setSize=a.setSize||function(g,f,c){this.shape.setSize(g,f,c)};b.getBoundaryTo=a.getBoundaryTo||function(g,f,c){return this.shape.getBoundaryTo(g,f,c)};b.getBBox=a.getBBox||function(f,c){return this.shape.getBBox(f,c)};b.highlight=a.highlight||function(g,c,f){if(f){c.group.setAttribute("class",this.cssClass+" "+this.cssHl)}else{c.group.setAttribute("class",this.cssClass)}};return b},makeEdgeShape:function(a){var b={};a=a||{};b.markerStart=a.markerStart;b.markerEnd=a.markerEnd;b.draw=a.draw||function(g,h,f){var c=JSDot.helper.cesvg("path");h.line=c;if(this.markerStart){c.setAttribute("marker-start",this.markerStart)}if(this.markerEnd){c.setAttribute("marker-end",this.markerEnd)}f.appendChild(c);c=JSDot.helper.cesvg("path");h.handle=c;c.setAttribute("class","jsdot-edge-handle");f.appendChild(c);return c};b.setPosition=a.setPosition||function(f,h){var g=h.start;var c=h.end;h.line.setAttribute("d","M"+g[0]+","+g[1]+"L"+c[0]+","+c[1]);h.handle.setAttribute("d","M"+g[0]+","+g[1]+"L"+c[0]+","+c[1])};return b},makeEdgeStencil:function(a){var b={};a=a||{};if(typeof a.shape=="string"){b.shape=JSDot.edge_shapes[a.shape]||JSDot.edge_shapes.line}else{b.shape=a.shape||JSDot.edge_shapes.line}b.cssClass=a.cssClass||"jsdot_line_edge";b.cssHl=a.cssHl||"jsdot_def_hl";b.draw=a.draw||function(f,g,c){this.shape.draw(f,g,c);c.setAttribute("class",this.cssClass)};b.setPosition=a.setPosition||function(c,f){this.shape.setPosition(c,f)};b.highlight=a.highlight||function(c,f,g){if(g){f.group.setAttribute("class",this.cssClass+" "+this.cssHl)}else{f.group.setAttribute("class",this.cssClass)}};return b}};JSDot.jsdot_Impl=function(){this.handlers={};this.graph=new JSDot.Graph_impl(this);this.tools={}};JSDot.jsdot_Impl.prototype={addEventHandler:function(d,a,c){if(typeof a=="string"){if(typeof c!="function"){return}if(!this.handlers[a]){this.handlers[a]=[]}this.handlers[a].push([d,c])}else{for(var b in a){this.addEventHandler(d,b,a[b])}}},removeEventHandler:function(f,a,d){if(typeof a=="string"){if(typeof d!="function"){return}if(!this.handlers[a]){return}var c=this.handlers[a];for(var b in c){if(c[b][0]==f&&c[b][1]==d){c.splice(b,1);return}}}else{for(var b in a){this.removeEventHandler(f,b,a[b])}}},fireEvent:function(){var d=Array.prototype.shift.apply(arguments);var a=Array.prototype.shift.apply(arguments);if(!this.handlers[a]){return}for(var b in this.handlers[a]){var c=this.handlers[a][b];if(d==null||c[0]==null||c[0]==d){c[1].apply(d,arguments)}}},getToolI:function(h,b,g){var f=this.tools[h];if(!f){f=this.tools[h]={}}if(f[b]){return f[b]}var d=JSDot[h];var a=b.split(".");for(var c in a){d=d[a[c]];if(!d){return null}}if(!d){return null}if(typeof d=="function"){var c=new d;if(typeof c.init=="function"){if(!c.init(g)){return null}}f[b]=c;return c}else{if(typeof d=="object"){f[b]=d;return d}}return null},getTool:function(a,b){if(b){b.graph=this.graph}return this.getToolI("GraphTools",a,b)},};JSDot.Node_impl=function(b,a){this.graph=b;this.name=a;this.label={type:"plain",value:a};this.position=[0,0];this.stencil=b.defaultNodeStencil;this.edges={};this.userData={};this.isNode=true};JSDot.Node_impl.prototype={setLabel:function(a,b){if(this.label){this.label.value=a}else{this.label={type:"plain",value:a}}if(b==undefined||b){this.graph.jsdot.fireEvent(this.graph,"changed",this)}},setPosition:function(b,a){this.position=b;if(a==undefined||a){this.graph.jsdot.fireEvent(this.graph,"moved",this)}},setStencil:function(a,b){this.stencil=a;if(b==undefined||b){this.graph.jsdot.fireEvent(this.graph,"changed",this)}},setData:function(a,b){this.userData[a]=b},getData:function(a){return this.userData[a]},};JSDot.Node=function(b,a){this.getName=function(){return a.name};this.setLabel=function(c){a.setLabel(c)};this.setPosition=function(c){a.setPosition(c)};this.getPosition=function(){return a.position};this.setStencil=function(c){a.setStencil(c)}};JSDot.Edge_impl=function(a,d,b,c){this.graph=a;this.id=d;this.src=b;this.dst=c;this.label=null;this.stencil=a.defaultEdgeStencil;this.userData={};this.isEdge=true};JSDot.Edge_impl.prototype={setLabel:function(a,b){if(this.label){this.label.value=a}else{this.label={type:"plain",value:a}}if(b==undefined||b){this.graph.jsdot.fireEvent(this.graph,"changed",this)}},setStencil:function(a,b){this.stencil=a;if(b==undefined||b){this.graph.jsdot.fireEvent(this.graph,"changed",this)}},setData:function(a,b){this.userData[a]=b},getData:function(a){return this.userData[a]},};JSDot.Edge=function(b,a){this.setStencil=function(c){a.setStencil(c)};this.setLabel=function(c){a.setLabel(c)}};JSDot.Graph_impl=function(a){this.jsdot=a;this.defaultNodeStencil="circle";this.defaultEdgeStencil="line";this.nodes={};this.edges={};this.lastName=0;this.lastEId=0};JSDot.Graph_impl.prototype={clear:function(){JSDot.Graph_impl.call(this,this.jsdot);this.fireGraphEvent("newgraph")},getNodeByName:function(a){return this.nodes[a]},createNode:function(a,b){var d;if(a){d=a;if(this.nodes[d]){return null}}else{do{d=++this.lastName}while(this.nodes[d])}var c=new JSDot.Node_impl(this,d);this.nodes[d]=c;if(b==undefined||b){this.jsdot.fireEvent(this,"created",c)}return c},createEdge:function(c,f,a){var d;do{d=++this.lastEId}while(this.edges[d]);var b=new JSDot.Edge_impl(this,d,c,f);c.edges[d]=b;f.edges[d]=b;this.edges[d]=b;if(a==undefined||a){this.jsdot.fireEvent(this,"created",b)}return b},removeNode:function(c,a){var b;for(id in c.edges){b=c.edges[id];if(b.src==c){delete b.dst.edges[id]}else{delete b.src.edges[id]}delete this.edges[id]}delete this.nodes[c.name];if(a==undefined||a){this.jsdot.fireEvent(this,"removed",c)}},removeEdge:function(b,a){delete this.edges[b.id];delete b.src.edges[b.id];delete b.dst.edges[b.id];if(a==undefined||a){this.jsdot.fireEvent(this,"removed",b)}},setDefaultStencils:function(b,a){if(b&&JSDot.stencils[b]){this.defaultNodeStencil=b}if(a&&JSDot.edge_stencils[a]){this.defaultEdgeStencil=a}},fireGraphEvent:function(){Array.prototype.unshift.call(arguments,this);return this.jsdot.fireEvent.apply(this.jsdot,arguments)},};JSDot.Graph=function(b,a){this.createNode=function(c){var d=a.createNode(c);if(d){return new JSDot.Node(b,d)}else{return null}};this.createEdge=function(d,f){if(typeof d!="string"){d=d.getName()}if(typeof f!="string"){f=f.getName()}var c=a.createEdge(a.nodes[d],a.nodes[f]);return new JSDot.Edge(b,c)};this.clear=function(){a.clear()}};JSDot.shapes={circle:{size:"2.5em",draw:function(h,b,a){var f=JSDot.helper.cesvg("circle");f.setAttribute("r",this.size);a.appendChild(f);b.shape=f;return f},setPosition:function(c,b){var a=b.shape;a.setAttribute("cx",c.position[0]);a.setAttribute("cy",c.position[1])},getBoundaryTo:function(k,h,g){var j=k.position;var b=Math.atan2((g[1]-j[1]),(g[0]-j[0]));var f=h.shape.r.baseVal.value;return[j[0]+Math.cos(b)*f,j[1]+Math.sin(b)*f]},getBBox:function(b,a){return a.shape.getBBox()},setSize:function(c,b,a){b.shape.setAttribute("r",Math.max(a.height,a.width)/2+6)}},box:{draw:function(f,c,a){var b=JSDot.helper.cesvg("rect");b.setAttribute("height",30);b.setAttribute("width",50);a.appendChild(b);c.shape=b;return b},setPosition:function(c,b){var a=b.shape;a.setAttribute("x",c.position[0]-a.width.baseVal.value/2);a.setAttribute("y",c.position[1]-a.height.baseVal.value/2)},getBoundaryTo:function(c,l,a){var r=l.shape.x.baseVal.value;var o=l.shape.y.baseVal.value;var s=l.shape.height.baseVal.value;var b=l.shape.width.baseVal.value;var j=r;var g=r+b;var k=(a[1]-(o+s/2))/(a[0]-(r+b/2));if(Math.abs(a[1]-(o+s/2))<2){if(a[0]<g){return[j,a[1]]}else{return[g,a[1]]}}else{if(a[1]<o+s/2){var f=(o-a[1])/k+a[0];if(f<j){var q=(j-a[0])*k+a[1];return[j,q]}else{if(f>g){var h=(g-a[0])*k+a[1];return[g,h]}else{return[f,o]}}}else{var m=(o+s-a[1])/k+a[0];if(m<j){var q=(j-a[0])*k+a[1];return[j,q]}else{if(m>g){var h=(g-a[0])*k+a[1];return[g,h]}else{return[m,o+s]}}}}},getBBox:function(b,a){return a.shape.getBBox()},setSize:function(f,c,a){var b=c.shape;b.setAttribute("height",a.height+3);b.setAttribute("width",a.width+10);this.setPosition(f,c)}},hexagon:{dw:2,dh:2,ew:15,draw:function(f,c,a){var b=JSDot.helper.cesvg("polygon");a.appendChild(b);c.shape=b;return b},setPosition:function(b,a){a.shape.setAttribute("transform","translate("+b.position[0]+" "+b.position[1]+")")},getBoundaryTo:function(c,l,a){var s=l.size.height;var b=l.size.width;var q=c.position[0]-b/2;var o=c.position[1]-s/2;var j=q;var h=q+b;var k=(a[1]-c.position[1])/(a[0]-c.position[0]);if(Math.abs(a[1]-(o+s/2))<2){if(a[0]<h){return[j-this.ew,a[1]]}else{return[h+this.ew,a[1]]}}else{if(a[1]<o+s/2){var g=(o-a[1])/k+a[0];if(g<j){var r=-(s/2)/this.ew;var f=(r*j-o-k*a[0]+a[1])/(r-k);return[f,(f-j)*r+o]}else{if(g>h){var r=(s/2)/this.ew;var f=(r*h-o-k*a[0]+a[1])/(r-k);return[f,(f-h)*r+o]}else{return[g,o]}}}else{var m=(o+s-a[1])/k+a[0];if(m<j){var r=(s/2)/this.ew;var f=(r*j-(o+s)-k*a[0]+a[1])/(r-k);return[f,(f-j)*r+o+s]}else{if(m>h){var r=-(s/2)/this.ew;var f=(r*h-(o+s)-k*a[0]+a[1])/(r-k);return[f,(f-h)*r+o+s]}else{return[m,o+s]}}}}},getBBox:function(f,c){var a=c.shape.getBBox();a.x+=f.position[0];a.y+=f.position[1];return a},setSize:function(j,g,c){var a=c.width/2+this.dw;var b=c.height/2+this.dh;var f=[-a,-b,a,-b,a+this.ew,0,a,b,-a,b,-a-this.ew,0];g.shape.setAttribute("points",f.join(" "));g.size={height:c.height+2*this.dh,width:c.width+2*this.dw}}},"concave hexagon":{dw:8,dh:2,ew:15,draw:function(f,c,a){var b=JSDot.helper.cesvg("polygon");a.appendChild(b);c.shape=b;return b},setPosition:function(b,a){a.shape.setAttribute("transform","translate("+b.position[0]+" "+b.position[1]+")")},getBoundaryTo:function(c,l,a){var s=l.size.height;var b=l.size.width;var q=c.position[0]-b/2-this.ew;var o=c.position[1]-s/2;var j=q;var h=q+b+2*this.ew;var k=(a[1]-c.position[1])/(a[0]-c.position[0]);if(Math.abs(a[1]-(o+s/2))<2){if(a[0]<h){return[j+this.ew,a[1]]}else{return[h-this.ew,a[1]]}}else{if(a[1]<o+s/2){var g=(o-a[1])/k+a[0];if(g<j){var r=(s/2)/this.ew;var f=(r*j-o-k*a[0]+a[1])/(r-k);return[f,(f-j)*r+o]}else{if(g>h){var r=-(s/2)/this.ew;var f=(r*h-o-k*a[0]+a[1])/(r-k);return[f,(f-h)*r+o]}else{return[g,o]}}}else{var m=(o+s-a[1])/k+a[0];if(m<j){var r=-(s/2)/this.ew;var f=(r*j-(o+s)-k*a[0]+a[1])/(r-k);return[f,(f-j)*r+o+s]}else{if(m>h){var r=(s/2)/this.ew;var f=(r*h-(o+s)-k*a[0]+a[1])/(r-k);return[f,(f-h)*r+o+s]}else{return[m,o+s]}}}}},getBBox:function(f,c){var a=c.shape.getBBox();a.x+=f.position[0];a.y+=f.position[1];return a},setSize:function(j,g,c){var a=c.width/2+this.dw;var b=c.height/2+this.dh;var f=[-a-this.ew,-b,a+this.ew,-b,a,0,a+this.ew,b,-a-this.ew,b,-a,0];g.shape.setAttribute("points",f.join(" "));g.size={height:c.height+2*this.dh,width:c.width+2*this.dw}}},};JSDot.stencils={circle:JSDot.helper.makeCssStencil(),box:JSDot.helper.makeCssStencil({shape:JSDot.shapes.box,cssClass:"jsdot_box"}),hexagon:JSDot.helper.makeCssStencil({shape:JSDot.shapes.hexagon,cssClass:"jsdot_hexagon"}),"concave hexagon":JSDot.helper.makeCssStencil({shape:JSDot.shapes["concave hexagon"],cssClass:"jsdot_concave_hexagon"}),};JSDot.edge_shapes={line:JSDot.helper.makeEdgeShape(),"directed line":JSDot.helper.makeEdgeShape({markerEnd:"url(#Arrow)"}),"bidi line":JSDot.helper.makeEdgeShape({markerStart:"url(#ArrowS)",markerEnd:"url(#Arrow)"}),};JSDot.edge_stencils={line:JSDot.helper.makeEdgeStencil(),"directed line":JSDot.helper.makeEdgeStencil({shape:JSDot.edge_shapes["directed line"],cssClass:"jsdot_dirline_edge"}),"bidi line":JSDot.helper.makeEdgeStencil({shape:JSDot.edge_shapes["bidi line"],cssClass:"jsdot_bidiline_edge"}),};JSDot.load_svg_shapes=function(b,d){var f=new XMLHttpRequest();if(f.overrideMimeType){f.overrideMimeType("text/xml")}f.open("GET",d,false);f.send();var c=f.responseXML;var a=c.getElementsByTagName("defs")[0];a.parentNode.removeChild(a);b.svgroot.appendChild(a);return};JSDot.node_label_stencils={plain:{draw:function(f,c,b){var a=JSDot.helper.cesvg("text");a.setAttribute("class","jsdot_node_label");a.textContent=f.label.value;b.appendChild(a);c.label=a;return a},setPosition:function(c,b){var a=b.label;a.setAttribute("x",c.position[0]);a.setAttribute("y",c.position[1])},getSize:function(b,a){return a.label.getBBox()},},};JSDot.edge_label_stencils={plain:{draw:function(f,c,b){var a=JSDot.helper.cesvg("text");a.setAttribute("class","jsdot-edge-label");a.textContent=f.label.value;b.appendChild(a);c.label=a;return a},setPosition:function(g,f){var c=f.start;var b=f.end;var a=f.label;a.setAttribute("x",c[0]+(b[0]-c[0])/2);a.setAttribute("y",c[1]+(b[1]-c[1])/2)},getSize:function(b,a){return a.label.getBBox()},},};JSDot.View=function(b,a){this.jsdot=b;this.divId=a;this.container=document.getElementById(a);this.container.setAttribute("class",(this.container.getAttribute("class")||"")+" jsdot-container");this.svgdoc=this.container.ownerDocument;var c=document.createElement("div");this.container.appendChild(c);this.svgroot=JSDot.helper.cesvg("svg");c.appendChild(this.svgroot);c.setAttribute("style","height: 100%; width: 100%;");this.svgroot.setAttribute("id",a+"_svg");this.svgroot.setAttribute("xmlns",JSDot.helper.svgns);this.svgroot.setAttribute("xmlns:xlink",JSDot.helper.xlinkns);this.nodeData={};this.edgeData={};this.redrawAll();this.addHandler()};JSDot.View.prototype={getViewId:function(){return this.divId},drawNode:function(d){if(!d){return}var c=this.nodeData[d.name];if(!c){c={};this.nodeData[d.name]=c}var b=JSDot.helper.cesvg("g");b.jsdot_node=d;b.setAttribute("id",this.getViewId()+"+"+d.name);this.svgroot.appendChild(b);c.group=b;c.stencil=JSDot.stencils[d.stencil];if(!c.stencil){for(var a in JSDot.stencils){c.stencil=JSDot.stencils[a];break}}c.stencil.draw(d,c,b);c.stencil.setPosition(d,c);if(!c.labelStencil){c.labelStencil=JSDot.node_label_stencils[d.label.type];if(!c.labelStencil){c.labelStencil=JSDot.node_label_stencils.plain}d.label.value=d.label.value||""}c.labelStencil.draw(d,c,b);c.labelStencil.setPosition(d,c);c.stencil.setSize(d,c,c.labelStencil.getSize(d,c));this.svgFitSize()},updateNodePos:function(b){var a=this.nodeData[b.name];a.stencil.setPosition(b,a);a.labelStencil.setPosition(b,a);this.svgFitSize()},drawNodeWithEdges:function(b){this.drawNode(b);for(var a in b.edges){this.drawEdge(b.edges[a])}},removeNode:function(b){var a=this.nodeData[b.name];if(a){this.svgroot.removeChild(a.group);delete this.nodeData[b.name]}},drawEdge:function(d){var a=this.edgeData[d.id];if(!a){a={};this.edgeData[d.id]=a}a.stencil=JSDot.edge_stencils[d.stencil];if(!a.stencil){for(var b in JSDot.edge_stencils){a.stencil=JSDot.edge_stencils[b];break}}var c=JSDot.helper.cesvg("g");c.jsdot_edge=d;c.setAttribute("id",this.getViewId()+"+edge+"+d.id);this.svgroot.appendChild(c);a.group=c;this.computeEdgePosition(d);a.stencil.draw(d,a,c);a.stencil.setPosition(d,a);if(d.label){if(!a.labelStencil){a.labelStencil=JSDot.edge_label_stencils[d.label.type];if(!a.labelStencil){a.labelStencil=JSDot.edge_label_stencils.plain}d.label.value=d.label.value||""}a.labelStencil.draw(d,a,c);a.labelStencil.setPosition(d,a)}},updateEdgePos:function(b){this.computeEdgePosition(b);var a=this.edgeData[b.id];a.stencil.setPosition(b,a);if(b.label){a.labelStencil.setPosition(b,a)}},computeEdgePosition:function(c){var a=this.edgeData[c.id];var d=this.nodeData[c.src.name];var b=this.nodeData[c.dst.name];a.start=d.stencil.getBoundaryTo(c.src,d,c.dst.position);a.end=b.stencil.getBoundaryTo(c.dst,b,c.src.position)},removeEdge:function(b){var a=this.edgeData[b.id];if(a.group){this.svgroot.removeChild(a.group);delete this.edgeData[b.id]}},redrawAll:function(){for(var a in this.edgeData){this.svgroot.removeChild(this.edgeData[a].group)}for(var a in this.nodeData){this.svgroot.removeChild(this.nodeData[a].group)}this.edgeData={};this.nodeData={};var b=this.jsdot.graph.nodes;for(var a in b){this.drawNode(b[a])}b=this.jsdot.graph.edges;for(var a in b){this.drawEdge(b[a])}},getBBox:function(a){if(a.isNode){var b=this.nodeData[a.name];return b.stencil.getBBox(a,b)}else{return{height:0,width:0,x:0,y:0}}},addHandler:function(){var b={};var a=this;var c=function(h,f){var g;if(h.isNode){g=a.nodeData[h.name]}else{g=a.edgeData[h.id]}g.stencil.highlight(h,g,f);g.highlight=f};b.created=function(d){if(d.isEdge){a.drawEdge(d)}else{a.drawNodeWithEdges(d)}};b.removed=function(d){if(d.isEdge){a.removeEdge(d)}else{a.removeNode(d);for(e in d.edges){a.removeEdge(d.edges[e])}}};b.moved=function(f){if(f.isNode){a.updateNodePos(f);for(var d in f.edges){a.updateEdgePos(f.edges[d])}}};b.changed=function(f){if(f.isEdge){var d=a.edgeData[f.id].highlight;a.removeEdge(f);a.drawEdge(f);if(d){c(f,d)}}else{var d=a.nodeData[f.name].highlight;a.removeNode(f);a.drawNode(f);if(d){c(f,d)}for(i in f.edges){a.updateEdgePos(f.edges[i])}}};b.newgraph=function(){a.redrawAll()};this.jsdot.addEventHandler(null,b);this.jsdot.addEventHandler(this,"selectionchg",c)},getOffset:function(c){var a=0,b=0;do{a+=c.offsetLeft;b+=c.offsetTop;c=c.offsetParent}while(c);return[a,b]},getScrollOffset:function(c){var a=0,b=0;while((c=c.parentNode).parentNode){a+=c.scrollLeft;b+=c.scrollTop}return[a,b]},addRelCoord:function(a){a.relX=a.layerX;a.relY=a.layerY},fireViewEvent:function(){Array.prototype.unshift.call(arguments,this);return this.jsdot.fireEvent.apply(this.jsdot,arguments)},addClass:function(a){var b=(this.svgroot.getAttribute("class")||"").split(" ");if(b.indexOf(a)<0){b.push(a);this.svgroot.setAttribute("class",b.join(" "))}},removeClass:function(a){var d=(this.svgroot.getAttribute("class")||"").split(" ");var b=d.indexOf(a);if(b<0){return}d.splice(b,1);this.svgroot.setAttribute("class",d.join(" "))},svgFitSize:function(){var g=this.svgroot.getBoundingClientRect();var c=this.container;var f=this.svgroot.parentNode;var b=f.getBoundingClientRect();var a=g.left-b.left+g.width;var d=g.top-b.top+g.height;a=Math.max(c.clientWidth-5,a);d=Math.max(c.clientHeight-10,d);f.style.width=a?a+"px":"";f.style.height=d?d+"px":""},getTool:function(a,b){if(b){b.graph=this.jsdot.graph;b.view=this}return this.jsdot.getToolI("ViewTools",a,b)},};JSDot.Selection=function(b,a){this.jsdot=b;this.view=a;this.allowNodes=true;this.allowEdges=true;this.allowMultiple=true;this.allowDrag=true;this.selection=[];this.moving=false;this.moveStart=null;this.evtTarget=null;this.evtTargetType="";a.svgroot.addEventListener("mousedown",function(c){return function(){return c.svgMousedown.apply(c,arguments)}}(this),false);this.svgMousemove=function(c){return function(){return c.svgMousemove_impl.apply(c,arguments)}}(this);a.svgroot.addEventListener("mouseup",function(c){return function(){return c.svgMouseup.apply(c,arguments)}}(this),false);b.addEventHandler(b.graph,"removed",function(c){return function(){return c.removedH.apply(c,arguments)}}(this));b.addEventHandler(b.graph,"newgraph",function(c){return function(){return c.newgraphH.apply(c,arguments)}}(this))};JSDot.Selection.prototype={svgMousedown:function(a){a.preventDefault();this.moving=false;this.moveStart=a;this.setEvtTarget(a);if(this.allowDrag){this.view.svgroot.addEventListener("mousemove",this.svgMousemove,false)}},setEvtTarget:function(a){if(a.target.tagName.toLowerCase()=="svg"){this.evtTarget=null;this.evtTargetType="s"}else{var b=a.target.parentNode.jsdot_node;if(b){this.evtTarget=b;this.evtTargetType="n"}else{if(b=a.target.parentNode.jsdot_edge){this.evtTarget=b;this.evtTargetType="e"}}}},handleClick:function(a){if(!this.allowEdges&&!this.allowNodes){this.view.addRelCoord(a);this.view.fireViewEvent("click",this.evtTarget,a)}else{switch(this.evtTargetType){case"s":this.deselectAll();break;case"n":case"e":if(this.isSelected(this.evtTarget)){if(a.ctrlKey){this.deselect(this.evtTarget)}else{this.deselectAll();this.select(this.evtTarget)}}else{if(!a.ctrlKey){this.deselectAll()}this.select(this.evtTarget)}break;default:}}},svgMousemove_impl:function(b){var c=b.pageX-this.moveStart.pageX;var a=b.pageY-this.moveStart.pageY;if(!this.moving){if(Math.abs(c)>2||Math.abs(a)>2){this.moving=true;this.view.fireViewEvent("pick",this.evtTarget)}}if(this.moving){b.dx=c;b.dy=a;this.view.fireViewEvent("drag",this.evtTarget,b)}},svgMouseup:function(a){this.view.svgroot.removeEventListener("mousemove",this.svgMousemove,false);if(!this.moving){this.handleClick(this.moveStart)}else{a.dx=a.pageX-this.moveStart.pageX;a.dy=a.pageY-this.moveStart.pageY;this.view.fireViewEvent("drop",this.evtTarget,a)}this.moving=false;this.moveStart=null},removedH:function(a){if(a.isNode){for(var b in a.edges){this.deselect(a.edges[b],false)}}this.deselect(a,false)},newgraphH:function(){this.selection.length=0},select:function(a){if(this.isSelected(a)){return}if(a.isEdge&&this.allowEdges||a.isNode&&this.allowNodes){if(!this.allowMultiple){this.deselectAll()}this.selection.push(a);this.view.fireViewEvent("selectionchg",a,true)}},deselect:function(b,a){if(this.isSelected(b)){this.selection.splice(this.selection.indexOf(b),1);if(a!==false){this.view.fireViewEvent("selectionchg",b,false)}}},deselectAll:function(){var a;while(a=this.selection.pop()){this.view.fireViewEvent("selectionchg",a,false);a=undefined}},isSelected:function(a){return(this.selection.indexOf(a)>=0)},firstNode:function(){for(var a in this.selection){if(this.selection[a].isNode){return this.selection[a]}}return null},forNodes:function(b){for(var a in this.selection){if(this.selection[a].isNode){b(this.selection[a])}}},forEdges:function(b){for(var a in this.selection){if(this.selection[a].isEdge){b(this.selection[a])}}},};JSDot.Drag=function(d,a,c){var b=this;this.nodes=null;this.edges=null;this.pick=function(l){b.nodes=[];b.edges=[];if(!l||!l.isNode){return}var h=[];if(!c.isSelected(l)){h=[l]}else{h=c.selection}for(var g in h){if(h[g].isNode){a.nodeData[h[g].name].drag=h[g].position;b.nodes.push(h[g]);var k=h[g].edges;for(var f in k){if(!(k[f] in b.edges)){b.edges.push(k[f])}}}}};this.drag=function(j,f){for(var g in b.nodes){var h=a.nodeData[b.nodes[g].name].drag;b.nodes[g].setPosition([h[0]+f.dx,h[1]+f.dy],false);a.updateNodePos(b.nodes[g])}for(var g in b.edges){a.updateEdgePos(b.edges[g])}};this.drop=function(g,f){for(i in b.nodes){a.fireViewEvent("moved",b.nodes[i])}b.nodes=[];b.edges=[]}};JSDot.GraphTools.json=function(){};JSDot.GraphTools.json.prototype={init:function(a){if(!a||!a.graph){return null}this.graph=a.graph;return this},importGraph:function(k){var d=this.graph;var j={};var h=k;if(typeof k==="string"){try{h=JSON.parse(k)}catch(f){return 1}}if(!h){return 1}d.setDefaultStencils(h.defaultNodeStencil,h.defaultEdgeStencil);if(typeof h.nodes!="object"||typeof h.edges!="object"){return 1}for(var b in h.nodes){var a=h.nodes[b];if(j[a.name]){return 2}var l=d.createNode(a.name,false);if(!l){l=d.createNode(null,false)}j[a.name]=l;if(a.label){l.setLabel(a.label.value,false)}if(a.position){l.setPosition(a.position,false)}if(typeof a.stencil=="string"){l.setStencil(a.stencil,false)}if(a.userData&&a.userData.data){l.setData("data",a.userData.data)}}for(var b in h.edges){var a=h.edges[b];if(!j[a.src]||!j[a.dst]){return 3}var l=d.createEdge(j[a.src],j[a.dst],false);if(a.label){l.setLabel(a.label.value,false)}if(typeof a.stencil=="string"){l.setStencil(a.stencil,false)}if(a.userData&&a.userData.data){l.setData("data",a.userData.data)}}this.graph.fireGraphEvent("newgraph");return 0},exportGraph:function(){var c={nodes:[],edges:[],defaultNodeStencil:this.graph.defaultNodeStencil,defaultEdgeStencil:this.graph.defaultEdgeStencil,};var a=this.graph.nodes;for(var b in a){var d=a[b];c.nodes.push({name:d.name,label:d.label,position:d.position,stencil:d.stencil,userData:d.userData})}a=this.graph.edges;for(var b in a){var d=a[b];c.edges.push({src:d.src.name,dst:d.dst.name,label:d.label,stencil:d.stencil,userData:d.userData})}return JSON.stringify(c)},};JSDot.ViewTools.Layout.Center=function(){};JSDot.ViewTools.Layout.Center.prototype={init:function(a){this.view=a.view;this.graph=a.graph;return true},doLayout:function(){var h=this.graph.nodes;var b=0,m=0,k=0,f=0;for(var j in h){var d=h[j].position;b=k=d[0];m=f=d[1];break}for(var j in h){var d=h[j].position;var l=this.view.getBBox(h[j]);b=Math.min(b,l.x);k=Math.max(k,l.x+l.width);m=Math.min(m,l.y);f=Math.max(f,l.y+l.height)}var g=this.view.svgroot.parentNode.getBoundingClientRect();var c=Math.min(1,g.width/(k-b));var a=Math.min(1,g.height/(f-m));var o=0;var n=0;if(c!=1){o=-b}else{if(b<0){o=-b}else{if(k>g.width){o=g.width-k}}}if(a!=1){n=-m}else{if(m<0){n=-m}else{if(f>g.height){n=g.height-f}}}for(var j in h){var d=h[j].position;h[j].setPosition([(d[0]+o)*c,(d[1]+n)*a])}},};JSDot.ViewTools.Layout.SpringEmbedder=function(){this.options={nodesep:20,iterations:20,}};JSDot.ViewTools.Layout.SpringEmbedder.prototype={init:function(a){this.view=a.view;this.graph=a.graph;return true},doLayout:function(){this.nodes={};this.edges={};var g=this.graph.nodes;for(var c in g){var f=g[c].position;this.nodes[c]={bb:this.view.getBBox(g[c]),x:f[0],y:f[1],accelx:0,accely:0,node:g[c]}}var b=this.graph.edges;for(var c in b){var a=this.nodes[b[c].src.name].bb;var d=this.nodes[b[c].dst.name].bb;this.edges[c]={edgelen:Math.max(a.width,a.height)+Math.max(d.width,d.height)+this.options.nodesep,src:this.nodes[b[c].src.name],dst:this.nodes[b[c].dst.name]}}for(var c=this.options.iterations;c>0;c--){this.springEmbedder()}this.updateRealNodes();delete this.nodes;delete this.edges;this.view.getTool("Layout.Center",{}).doLayout()},updateRealNodes:function(){var b=this.nodes;for(var a in b){var c=b[a];c.node.setPosition([c.x,c.y])}},springEmbedder:function(){var g=this.edges;for(var c in g){var o=g[c].dst.x-g[c].src.x;var n=g[c].dst.y-g[c].src.y;var l=Math.sqrt(o*o+n*n);if(l==0){l=this.options.nodesep}var k=(g[c].edgelen-l)/(l*3);var q=k*o;var p=k*n;g[c].src.accelx-=q;g[c].src.accely-=p;g[c].dst.accelx+=q;g[c].dst.accely+=p}var b=this.nodes;for(var c in b){var m=b[c];var q=0;var p=0;for(var a in b){if(c!=a){var h=b[a];var o=m.x-h.x;var n=m.y-h.y;var l=Math.sqrt(o*o+n*n);if(l==0){q+=Math.random();p+=Math.random()}else{q+=o/l;p+=n/l}}}var d=q*q+p*p;if(d>0){d=Math.sqrt(d)/2;m.accelx+=q*d;m.accely+=p*d}}for(var c in b){var m=b[c];m.x+=m.accelx*0.1;m.y+=m.accely*0.1;m.accelx=m.accelx/2;m.accely=m.accely/2}},};JSDot.EdgeViz=function(c,a,b){var d=this;this.start=null;this.jsdot=c;this.view=a;this.editor=b;this.line=null;this.moveH=null;this.cancelH=null;this.click=function(h,f){if(!h||!h.isNode){return}if(!d.start){d.start=h;d.line=JSDot.helper.cesvg("line");d.line.setAttribute("class","jsdot_edgeviz_line");d.view.svgroot.appendChild(d.line);d.line.setAttribute("x1",f.relX);d.line.setAttribute("y1",f.relY);d.line.setAttribute("x2",f.relX);d.line.setAttribute("y2",f.relY);d.moveH=d.mousemove(d.view,d.line);d.view.svgroot.addEventListener("mousemove",d.moveH,false);d.cancelH=function(j){return function(k){if(k.keyCode==27){j.cancel()}}}(d);document.addEventListener("keydown",d.cancelH,false);window.focus();return}var g=d.jsdot.graph.createEdge(d.start,h,false);if(d.editor){g.setStencil(d.editor.currentEdgeStencil,false)}d.cancel();d.jsdot.fireEvent(d.jsdot.graph,"created",g)};this.mousemove=function(g,f){return function(h){g.addRelCoord(h);f.setAttribute("x2",h.relX);f.setAttribute("y2",h.relY)}};this.cancel=function(){if(d.moveH){d.view.svgroot.removeEventListener("mousemove",d.moveH,false)}if(d.cancelH){document.removeEventListener("keydown",d.cancelH,false)}if(d.line){d.view.svgroot.removeChild(d.line)}d.moveH=null;d.cancelH=null;d.line=null;d.start=null}};JSDot.Editor=function(f,b,d){this.jsdot=f;this.view=b;this.selection=d;this.tbContainer=null;this.currentNodeStencil=null;this.currentEdgeStencil=null;this.editDialog=null;this.activeNested=null;this.nestedBars={};var a=document.createElement("div");a.setAttribute("class","ui-widget-header ui-corner-all jsdot-toolbar");document.body.appendChild(a);this.tbContainer=a;var g=b.getOffset(b.container);if(g[1]>25){g[1]-=25}a.style.top=g[1]+"px";a.style.left=g[0]+"px";for(var c in JSDot.stencils){this.currentNodeStencil=c;break}for(var c in JSDot.edge_stencils){this.currentEdgeStencil=c;break}new JSDot.Editor.MainBar(this,a);this.editDialog=new JSDot.Editor.EditDialog(this)};JSDot.Editor.prototype={setSelected:function(c,a){if(c.selected){if(c.selected.onDeselect){c.selected.onDeselect()}$(c.selected).removeClass("jsdot-tb-selected")}$(a).addClass("jsdot-tb-selected");c.selected=a},addNestedBar:function(a){this.nestedBars[a.name]=a;$(a.container).addClass("ui-widget ui-corner-all jsdot-tb-nested jsdot-tb-hiddentb");this.tbContainer.appendChild(a.container)},showNestedBar:function(a){this.hideNestedBar();if(this.nestedBars[a]){$(this.nestedBars[a].container).removeClass("jsdot-tb-hiddentb")}this.activeNested=this.nestedBars[a]},hideNestedBar:function(){if(this.activeNested){$(this.activeNested.container).addClass("jsdot-tb-hiddentb")}this.activeNested=null},getTool:function(a,b){if(b){b.graph=this.jsdot.graph;b.view=this.view;b.editor=this}return this.jsdot.getToolI("EditTools",a,b)},};JSDot.Editor.MainBar=function(h,a){var f=this;this.editor=h;this.dragH=new JSDot.Drag(h.jsdot,h.view,h.selection);this.createNodeH=this.createNodeH_T(h.jsdot);this.createEdgeH=new JSDot.EdgeViz(h.jsdot,h.view,h);this.removeH=this.removeH_T(h.jsdot);this.layoutBar=new JSDot.Editor.LayoutBar(h);this.createNodeBar=new JSDot.Editor.CreateNodeBar(h);this.createEdgeBar=new JSDot.Editor.CreateEdgeBar(h);this.selected=null;var j=document.createElement("div");j.setAttribute("class","jsdot-tb-handleL");a.appendChild(j);j=document.createElement("div");j.setAttribute("class","jsdot-tb-handleR");a.appendChild(j);$(a).draggable({handle:".jsdot-tb-handle"});var d=document.createElement("div");d.setAttribute("class","jsdot-tb-main");a.appendChild(d);var g=document.createElement("button");g.innerHTML="Select";d.appendChild(g);$(g).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-cursor"}}).click(function(){h.setSelected(f,g);h.jsdot.addEventHandler(h.view,f.dragH);var m=h.selection;m.allowNodes=true;m.allowEdges=true;m.allowMultiple=true;m.allowDrag=true;h.showNestedBar("layout")});g.onDeselect=function(){h.jsdot.removeEventHandler(h.view,f.dragH);h.hideNestedBar("layout")};var l=document.createElement("button");l.innerHTML="Add node";d.appendChild(l);$(l).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-addnode"}}).click(function(){h.setSelected(f,l);var m=h.selection;m.allowNodes=false;m.allowEdges=false;m.allowMultiple=false;m.allowDrag=false;m.deselectAll();h.jsdot.addEventHandler(h.view,"click",f.createNodeH);h.showNestedBar("createnode");h.view.addClass("jsdot-cursor-addnode")});l.onDeselect=function(){h.jsdot.removeEventHandler(h.view,"click",f.createNodeH);h.hideNestedBar("createnode");h.view.removeClass("jsdot-cursor-addnode")};var c=document.createElement("button");c.innerHTML="Add edge";d.appendChild(c);$(c).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-addedge"}}).click(function(){h.setSelected(f,c);var m=h.selection;m.allowNodes=false;m.allowEdges=false;m.allowMultiple=false;m.allowDrag=false;m.deselectAll();h.jsdot.addEventHandler(h.view,f.createEdgeH);h.showNestedBar("createedge");h.view.addClass("jsdot-cursor-addedge")});c.onDeselect=function(){h.jsdot.removeEventHandler(h.view,f.createEdgeH);f.createEdgeH.cancel();h.hideNestedBar("createedge");h.view.removeClass("jsdot-cursor-addedge")};var k=document.createElement("button");k.innerHTML="Remove node";d.appendChild(k);$(k).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-removenode"}}).click(function(){var o=h.selection;if(o.selection.length>0){var m=[];o.forNodes(function(p){m.push(p)});for(var n in m){h.jsdot.graph.removeNode(m[n])}m=[];o.forEdges(function(p){m.push(p)});for(var n in m){h.jsdot.graph.removeEdge(m[n])}}else{h.setSelected(f,k);o.allowNodes=false;o.allowEdges=false;o.allowMultiple=false;o.allowDrag=false;h.jsdot.addEventHandler(h.view,"click",f.removeH);h.view.addClass("jsdot-cursor-removenode")}});k.onDeselect=function(){h.jsdot.removeEventHandler(h.view,"click",f.removeH);h.view.removeClass("jsdot-cursor-removenode")};var b=document.createElement("button");b.innerHTML="Edit properties";d.appendChild(b);$(b).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-editdialog"}}).click(function(){h.editDialog.toggleOpen()});h.addNestedBar(this.layoutBar);h.addNestedBar(this.createNodeBar);h.addNestedBar(this.createEdgeBar);g.click()};JSDot.Editor.MainBar.prototype={createNodeH_T:function(b){var a=this.editor;return function(d,c){var f=b.graph.createNode(null,false);f.setPosition([c.relX,c.relY],false);if(a.currentNodeStencil){f.setStencil(a.currentNodeStencil,false)}b.fireEvent(b.graph,"created",f)}},removeH_T:function(a){return function(c,b){if(c&&c.isNode){a.graph.removeNode(c)}else{if(c&&c.isEdge){a.graph.removeEdge(c)}}}},};JSDot.Editor.LayoutBar=function(g){var j=document.createElement("div");this.name="layout";this.container=j;var b=document.createElement("button");b.innerHTML="Align left";j.appendChild(b);$(b).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-alignleft"}}).click(this.leftH(g));var k=document.createElement("button");k.innerHTML="Center";j.appendChild(k);$(k).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-aligncenter"}}).click(this.centerH(g));var h=document.createElement("button");h.innerHTML="Align right";j.appendChild(h);$(h).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-alignright"}}).click(this.rightH(g));var f=document.createElement("button");f.innerHTML="Align top";j.appendChild(f);$(f).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-aligntop"}}).click(this.topH(g));var c=document.createElement("button");c.innerHTML="Center vertically";j.appendChild(c);$(c).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-alignvcenter"}}).click(this.vcenterH(g));var a=document.createElement("button");a.innerHTML="Align bottom";j.appendChild(a);$(a).button({text:false,icons:{primary:"jsdot-icon jsdot-icon-alignbottom"}}).click(this.bottomH(g))};JSDot.Editor.LayoutBar.prototype={leftH:function(a){return function(){var d=a.selection;var c=a.view;var f=d.firstNode();if(!f){return}var b=c.getBBox(f).x;d.forNodes(function(h){var g=c.getBBox(h).x;if(g<b){b=g}});d.forNodes(function(g){g.setPosition([b+c.getBBox(g).width/2,g.position[1]])})}},centerH:function(a){return function(){var c=a.selection;var f=c.firstNode();if(!f){return}var b=f.position[0];var d=b;c.forNodes(function(g){if(g.position[0]<b){b=g.position[0]}if(g.position[0]>d){d=g.position[0]}});b=b+(d-b)/2;c.forNodes(function(g){g.setPosition([b,g.position[1]])})}},rightH:function(a){return function(){var c=a.selection;var b=a.view;var g=c.firstNode();if(!g){return}var f=b.getBBox(g);var d=f.x+f.width;c.forNodes(function(h){f=b.getBBox(h);f=f.x+f.width;if(f>d){d=f}});c.forNodes(function(h){h.setPosition([d-b.getBBox(h).width/2,h.position[1]])})}},topH:function(a){return function(){var c=a.selection;var b=a.view;var f=c.firstNode();if(!f){return}var d=b.getBBox(f).y;c.forNodes(function(h){var g=b.getBBox(h).y;if(g<d){d=g}});c.forNodes(function(g){g.setPosition([g.position[0],d+b.getBBox(g).height/2])})}},vcenterH:function(a){return function(){var c=a.selection;var f=c.firstNode();if(!f){return}var d=f.position[1];var b=d;c.forNodes(function(g){if(g.position[1]<d){d=g.position[1]}if(g.position[1]>b){b=g.position[1]}});d+=(b-d)/2;c.forNodes(function(g){g.setPosition([g.position[0],d])})}},bottomH:function(a){return function(){var c=a.selection;var b=a.view;var g=c.firstNode();if(!g){return}var d=b.getBBox(g);var f=d.y+d.height;c.forNodes(function(h){d=b.getBBox(h);d=d.y+d.height;if(d>f){f=d}});c.forNodes(function(h){h.setPosition([h.position[0],f-b.getBBox(h).height/2])})}},};JSDot.Editor.CreateNodeBar=function(c){var f=document.createElement("div");this.name="createnode";this.container=f;var a=document.createElement("select");for(var b in JSDot.stencils){a.add(new Option(b,b,b==c.currentNodeStencil),null)}f.appendChild(a);a.addEventListener("change",function(){c.currentNodeStencil=this.value},false)};JSDot.Editor.CreateEdgeBar=function(c){var f=document.createElement("div");this.name="createedge";this.container=f;var a=document.createElement("select");for(var b in JSDot.edge_stencils){a.add(new Option(b,b,b==c.currentEdgeStencil),null)}f.appendChild(a);a.addEventListener("change",function(){c.currentEdgeStencil=this.value},false)};JSDot.Editor.EditDialog=function(g){var s=document.createElement("div");g.view.container.appendChild(s);$(s).dialog({autoOpen:false,closeOnEscape:false,position:"right",dialogClass:"jsdot-editdialog"});var a=document.createElement("div");a.setAttribute("class","ui-accordion ui-widget ui-helper-reset ui-accordion-icons");a.setAttribute("role","tablist");s.appendChild(a);function q(z,y){var B=document.createElement("h3");B.appendChild(document.createTextNode(z));B.setAttribute("class","ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");B.setAttribute("role","tab");a.appendChild(B);var A=document.createElement("div");A.setAttribute("class","ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");A.setAttribute("role","tabpanel");a.appendChild(A);$(B).click(function(){$(A).toggleClass("ui-accordion-content-active");$(B).toggleClass("ui-corner-all ui-corner-top")});if(y&&y.expanded){$(B).click()}return{name:z,header:B,content:A}}var x=q("Selection",{expanded:true}).content;var j=document.createElement("p");j.innerHTML="edit dialog";x.appendChild(j);var d=document.createElement("div");x.appendChild(d);var l=document.createElement("select");d.appendChild(l);l.addEventListener("change",function(){var y=g.selection.selection[0];y.setStencil(this.value)},false);var v=document.createElement("input");d.appendChild(v);v.addEventListener("keypress",function(y){switch(y.keyCode){case 27:b.selectionchg();break;case 13:var z=g.selection.selection[0];z.setLabel(this.value);break}},false);var u=document.createElement("textarea");d.appendChild(u);u.addEventListener("keypress",function(y){switch(y.keyCode){case 27:b.selectionchg();break;case 13:var z=g.selection.selection[0];z.setData("data",this.value);break}},false);var h=document.createElement("div");x.appendChild(h);var k=document.createElement("select");h.appendChild(k);k.addEventListener("change",function(){var y=g.selection.selection[0];y.setStencil(this.value)},false);var n=document.createElement("input");h.appendChild(n);n.addEventListener("keypress",function(y){switch(y.keyCode){case 27:b.selectionchg();break;case 13:var z=g.selection.selection[0];z.setLabel(this.value);break}},false);var p=document.createElement("textarea");h.appendChild(p);p.addEventListener("keypress",function(y){switch(y.keyCode){case 27:b.selectionchg();break;case 13:var z=g.selection.selection[0];z.setData("data",this.value);break}},false);var w=q("Layout",{expanded:false}).content;var f=document.createElement("select");for(var r in JSDot.ViewTools.Layout){f.add(new Option(r),null)}w.appendChild(f);var o=document.createElement("button");w.appendChild(o);$(o).button({icons:{primary:"ui-icon-check"},label:"Apply",}).click(function(){var y=g.view.getTool("Layout."+f.value,{});if(y){y.doLayout()}$(this).blur()});var c=q("Tools",{expanded:false}).content;var t=document.createElement("button");t.appendChild(document.createTextNode("Edit JSON"));c.appendChild(t);$(t).button().click(function(){var y=g.getTool("jsonDialog",{});if(y){y.show(g.jsdot)}});this.toggleOpen=function(){if($(s).dialog("isOpen")){$(s).dialog("close")}else{$(s).dialog("open");b.selectionchg()}};var b={selectionchg:function(){if(!$(s).dialog("isOpen")){return}var A=0,z=0;g.selection.forNodes(function(){++A});g.selection.forEdges(function(){++z});if(A+z==0){j.innerHTML="Nothing selected.";$(d).hide();$(h).hide()}else{if(A+z>1){$(d).hide();$(h).hide();j.innerHTML=(A?A+" node"+(A>1?"s":"")+(z?" and ":""):"")+(z?z+" edge"+(z>1?"s":""):"")+" selected."}else{var B=g.selection.selection[0];if(B.isNode){j.innerHTML='Node "'+B.name+'".';l.innerHTML="";for(var y in JSDot.stencils){l.add(new Option(y,y,y==B.stencil),null)}$(v).blur();v.value=B.label.value;u.value=B.getData("data");$(h).hide();$(d).show()}else{if(B.isEdge){j.innerHTML='Edge "'+B.id+'".';k.innerHTML="";for(var y in JSDot.edge_stencils){k.add(new Option(y,y,y==B.stencil),null)}$(n).blur();n.value=(B.label?B.label.value:"");p.value=B.getData("data");$(d).hide();$(h).show()}}}}},changed:function(y){if(y==g.selection.selection[0]){b.selectionchg()}},};var m=function(){b.selectionchg()};g.jsdot.addEventHandler(g.view,b);g.jsdot.addEventHandler(g.graph,"removed",m);g.jsdot.addEventHandler(g.graph,"newgraph",m);this.toggleOpen()};JSDot.EditTools.jsonDialog={show:function(f){var b=f.getTool("json",{});var d=b.exportGraph();var h=document.createElement("textarea");h.value=d;var a=document.createElement("div");a.appendChild(h);function c(g){if(g){f.graph.clear()}var j=null;switch(b.importGraph(h.value)){case 0:break;case 1:j="The input is not a well-formed representation of a graph.";break;case 2:j="The input contains nodes with duplicate names.";break;case 3:j="An edge link to an inexistent node.";break;default:j="Unknown error encountered.";break}if(j){var k=document.createElement("div");k.appendChild(document.createTextNode(j));$(k).dialog({modal:true,close:function(){$(k).dialog("destroy");k.parentNode.removeChild(k)},buttons:{Ok:function(){$(this).dialog("close")}}})}else{$(a).dialog("close")}}$(a).dialog({dialogClass:"jsdot-editjson",modal:true,width:600,height:400,close:function(){$(a).dialog("destroy");a.parentNode.removeChild(a)},buttons:{Cancel:function(){$(a).dialog("close")},Import:function(){c(false)},Load:function(){c(true)},},})},};